/*!
 * @overview  Ember Data Model Fragments
 * @copyright Copyright 2014 Lytics Inc. and contributors
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/lytics/ember-data.model-fragments/master/LICENSE
 * @version   0.2.0
 */
!function(a,b){b["true"]=a,function(){var a,b,c,d;!function(){var e={},f={};a=function(a,b,c){e[a]={deps:b,callback:c}},d=c=b=function(a){function c(b){if("."!==b.charAt(0))return b;for(var c=b.split("/"),d=a.split("/").slice(0,-1),e=0,f=c.length;f>e;e++){var g=c[e];if(".."===g)d.pop();else{if("."===g)continue;d.push(g)}}return d.join("/")}if(f[a])return f[a];if(f[a]={},!e[a])throw new Error("Could not find module "+a);for(var d,g=e[a],h=g.deps,i=g.callback,j=[],k=0,l=h.length;l>k;k++)j.push("exports"===h[k]?d={}:b(c(h[k])));var m=i.apply(this,j);return f[a]=d||m}}(),a("core-model",["ember","./model","exports"],function(a,b,c){"use strict";var d=a["default"],e=b["default"];e.proto();var f=["_setup","_unhandledEvent","send","transitionTo","data","isEmpty","isLoading","isLoaded","isDirty","isSaving","isDeleted","isNew","isValid","serialize","changedAttributes","eachAttribute","fragmentDidDirty","fragmentDidReset","rollbackFragments"].reduce(function(a,b){return a[b]=e.prototype[b]||d.meta(e.prototype).descs[b],a},{}),g=["attributes","eachAttribute","transformedAttributes","eachTransformedAttribute"].reduce(function(a,b){return a[b]=e[b]||d.meta(e).descs[b],a},{}),h=d.Object.extend(f,{eachRelationship:d.K,updateRecordArraysLater:d.K});h.reopenClass(g,{eachRelationship:d.K}),c["default"]=h}),a("ember",["exports"],function(a){"use strict";a["default"]=Ember}),a("fragments/array/fragment",["ember","./stateful","exports"],function(a,b,c){"use strict";var d=a["default"],e=b["default"],f=d.get,g=d.EnumerableUtils.map,h=e.extend({type:null,setupData:function(a){var b=f(this,"owner"),c=f(b,"store"),e=f(this,"type"),h=f(this,"name"),i=f(this,"content");a=g(d.makeArray(a),function(a,d){var f=i[d];return f||(f=c.buildFragment(e),f.setProperties({_owner:b,_name:h})),f.setupData(a),f}),this._super(a)},adapterDidCommit:function(){this._super(),this.invoke("adapterDidCommit")},isDirty:function(){return this._super()||this.isAny("isDirty")}.property("@each.isDirty","_originalState"),rollback:function(){this._super(),this.invoke("rollback")},serialize:function(){return this.invoke("serialize")},replaceContent:function(a,b,c){{var d=f(this,"owner"),e=(f(d,"store"),f(this,"type"),f(this,"name"));this.originalState}return c&&c.forEach(function(a){var b=f(a,"_owner");b||a.setProperties({_owner:d,_name:e})}),f(this,"content").replace(a,b,c)},addFragment:function(a){return this.addObject(a)},removeFragment:function(a){return this.removeObject(a)},createFragment:function(a){var b=f(this,"owner"),c=f(b,"store"),d=f(this,"type"),e=c.createFragment(d,a);return this.pushObject(e)}});c["default"]=h}),a("fragments/array/stateful",["ember","exports"],function(a,b){"use strict";var c=a["default"],d=c.get,e=c.set,f=Array.prototype.splice,g=c.ArrayProxy.extend({owner:null,name:null,init:function(){this._super(),e(this,"_originalState",[])},content:function(){return c.A()}.property(),setupData:function(a){var b=d(this,"content");a=c.makeArray(a),e(this,"_originalState",a),f.apply(b,[0,b.length].concat(a))},adapterDidCommit:function(){e(this,"_originalState",this.toArray())},isDirty:function(){return 0!==c.compare(this.toArray(),d(this,"_originalState"))}.property("[]","_originalState"),rollback:function(){this.setObjects(d(this,"_originalState"))},serialize:function(){return this.toArray()},arrayContentDidChange:function(){this._super.apply(this,arguments);var a=d(this,"owner"),b=d(this,"name");this.get("isDirty")?a.fragmentDidDirty(b,this):a.fragmentDidReset(b,this)},toStringExtension:function(){return"owner("+d(this,"owner.id")+")"}});b["default"]=g}),a("fragments/attributes",["ember","./array/stateful","./array/fragment","exports"],function(a,b,c,d){"use strict";function e(a,b){b=b||{};var c={type:"fragment",isAttribute:!0,isFragment:!0,options:b};return i.computed(function(c,d){function e(a){return a.setProperties({_owner:f,_name:c})}var f=this,g=this._data[c]||h(this,b,"object"),i=this._fragments[c];return g&&g!==i?(i||(i=e(this.store.buildFragment(a))),i.setupData(g),this._data[c]=i):i=g,arguments.length>1&&(i=d?e(d):null,this._data[c]!==i?this.fragmentDidDirty(c,i):this.fragmentDidReset(c,i)),this._fragments[c]=i}).property("data").meta(c)}function f(a,b){"string"!==i.typeOf(a)&&(b=a,a=null),b=b||{};var c={type:"fragment",isAttribute:!0,isFragment:!0,options:b,kind:"hasMany"};return i.computed(function(c,d){function e(){var b=a?k:j;return b.create({type:a,name:c,owner:f})}var f=this,g=this._data[c]||h(this,b,"array"),m=this._fragments[c]||null;return g&&g!==m?(m||(m=e()),m.setupData(g),this._data[c]=m):m=g,arguments.length>1&&(i.isArray(d)?(m||(m=e()),m.setObjects(d)):null===d&&(m=null),this._data[c]!==m||l(m,"isDirty")?this.fragmentDidDirty(c,m):this.fragmentDidReset(c,m)),this._fragments[c]=m}).property("data").meta(c)}function g(){return i.computed.alias("_owner").readOnly()}function h(a,b){var c;if("function"==typeof b.defaultValue)c=b.defaultValue();else{if(!b.defaultValue)return null;c=b.defaultValue}return i.copy(c,!0)}var i=a["default"],j=b["default"],k=c["default"],l=i.get;d.hasOneFragment=e,d.hasManyFragments=f,d.fragmentOwner=g}),a("fragments/ext",["../store","../model","exports"],function(a,b,c){"use strict";var d=a["default"],e=b["default"],f=Ember.get;d.reopen({buildFragment:function(a){return a=this.modelFor(a),a.create({store:this})},createFragment:function(a,b){var c=this.buildFragment(a);return b&&c.setProperties(b),c.send("loadedData"),c}}),e.reopen({_setup:function(){this._super(),this._fragments={}},updateFragmentData:Ember.beforeObserver("data",function(a){var b;for(var c in a._fragments)b=a._fragments[c],b&&a._data[c]&&b!==a._data[c]&&(b.setupData(a._data[c]),a._data[c]=b)}),adapterDidCommit:function(){this._super.apply(this,arguments);var a;for(var b in this._fragments)a=this._fragments[b],a&&a.adapterDidCommit()},changedAttributes:function(){var a=this._super();return Ember.keys(this._fragments).forEach(function(b){b in this._attributes&&(a[b]=!0)},this),a},rollback:function(){this._super(),this.rollbackFragments()},rollbackFragments:function(){var a;for(var b in this._fragments)a=this._fragments[b]=this._data[b],a&&a.rollback()},fragmentDidDirty:function(a,b){f(this,"isDeleted")||(this._attributes[a]=b,this.send("becomeDirty"))},fragmentDidReset:function(a){delete this._attributes[a],f(this,"isNew")||this.send("propertyWasReset",a)}}),c.Store=d,c.Model=e}),a("fragments/model",["ember","../core-model","./states","exports"],function(a,b,c,d){"use strict";var e=a["default"],f=b["default"],g=c["default"],h=e.get,i=f.extend(e.Comparable,e.Copyable,{_name:null,_owner:null,currentState:g.empty,setupData:function(a){var b=h(this,"store"),c=h(this,"name"),d=b.modelFor(this.constructor),e=b.serializerFor(d);this._attributes={},this._data=e.normalize(d,a,c),this.send("pushedData"),this.notifyPropertyChange("data")},rollback:function(){this._attributes={},this.rollbackFragments(),this.send("rolledBack"),this.notifyPropertyChange("data")},compare:function(a,b){return a===b?0:1},copy:function(){var a=h(this,"store"),b=a.modelFor(this.constructor),c={};return e.merge(c,this._data),e.merge(c,this._attributes),this.store.createFragment(b,c)},adapterDidCommit:function(){e.keys(this._inFlightAttributes).length&&(e.mixin(this._data,this._inFlightAttributes),this._inFlightAttributes={});var a;for(var b in this._fragments)a=this._fragments[b],a&&a.adapterDidCommit();this.transitionTo("saved")},toStringExtension:function(){return"owner("+h(this,"_owner.id")+")"},init:function(){this._super(),this._setup()}});d["default"]=i}),a("fragments/states",["ember","../states","exports"],function(a,b,c){"use strict";function d(a,b){for(var c in b)a[c]=b[c];return a}function e(a,b,c){a=d(b?f.create(b):{},a),a.parentState=b,a.stateName=c;for(var g in a)a.hasOwnProperty(g)&&"parentState"!==g&&"stateName"!==g&&"object"==typeof a[g]&&(a[g]=e(a[g],a,c+"."+g));return a}var f=a["default"],g=b["default"],h=f.get,i=g.loaded.saved.didSetProperty,j=g.loaded.updated.uncommitted.propertyWasReset,k=function(a){var b=h(a,"_owner"),c=h(a,"_name");b&&b.fragmentDidDirty(c,a)},l={isEmpty:!1,isLoading:!1,isLoaded:!1,isDirty:!1,isSaving:!1,isDeleted:!1,isNew:!1,isValid:!0,didSetProperty:i,propertyWasReset:f.K,becomeDirty:f.K,rolledBack:f.K,empty:{isEmpty:!0,loadedData:function(a){a.transitionTo("loaded.created")},pushedData:function(a){a.transitionTo("loaded.saved")}},loaded:{pushedData:function(a){a.transitionTo("saved")},saved:{setup:function(a){var b=h(a,"_owner"),c=h(a,"_name");b._fragments[c]&&(h(b,c+".isDirty")||b.fragmentDidReset(c,a))},pushedData:f.K,becomeDirty:function(a){a.transitionTo("updated")}},created:{isDirty:!0,setup:k},updated:{isDirty:!0,setup:k,propertyWasReset:j,rolledBack:function(a){a.transitionTo("saved")}}}};l=e(l,null,"root"),c["default"]=l}),a("fragments/transform",["../transform","exports"],function(a,b){"use strict";var c=a["default"],d=c.extend({deserialize:function(a){return a},serialize:function(a){return a?a.serialize():null}});b["default"]=d}),a("initializers",["./fragments/transform","exports"],function(a,b){"use strict";var c=a["default"],d=[{name:"fragmentTransform",before:"store",initialize:function(a,b){b.register("transform:fragment",c)}}];b["default"]=d}),a("main",["ember","./fragments/ext","./fragments/model","./fragments/array/fragment","./fragments/transform","./fragments/attributes","./initializers","exports"],function(a,b,c,d,e,f,g,h){"use strict";var i=a["default"],j=(b["default"],c["default"]),k=d["default"],l=e["default"],m=f.hasOneFragment,n=f.hasManyFragments,o=f.fragmentOwner,p=g["default"];DS.ModelFragment=j,DS.FragmentArray=k,DS.FragmentTransform=l,DS.hasOneFragment=m,DS.hasManyFragments=n,DS.fragmentOwner=o,i.onLoad("Ember.Application",function(a){p.forEach(a.initializer,a)}),i.libraries&&i.libraries.register("Model Fragments","0.2.0"),h["default"]=DS}),a("model",["exports"],function(a){"use strict";a["default"]=DS.Model}),a("states",["exports"],function(a){"use strict";a["default"]=DS.RootState}),a("store",["exports"],function(a){"use strict";a["default"]=DS.Store}),a("transform",["exports"],function(a){"use strict";a["default"]=DS.Transform}),b("main")["default"]}()}({},function(){return this}());