(function(){"use strict";var t=Ember;var r=DS;var e=DS.JSONAPISerializer;var n=DS.JSONSerializer;var a=DS.InternalModel;var i=DS.RootState;var s=DS.Model;var o=DS.Snapshot;var u=DS.Store;var f=DS.Transform;var l=t.get;var c=Object.create||t.create;var m=i.loaded.saved.didSetProperty;var v=i.loaded.updated.uncommitted.propertyWasReset;var h=function(t){var r=t._owner;var e=t._name;if(r){_(r,e,t)}};var d={isEmpty:false,isLoading:false,isLoaded:false,isDirty:false,isSaving:false,isDeleted:false,isNew:false,isValid:true,didSetProperty:m,propertyWasReset:t.K,becomeDirty:t.K,rolledBack:t.K,empty:{isEmpty:true,loadedData:function(t){t.transitionTo("loaded.created")},pushedData:function(t){t.transitionTo("loaded.saved")}},loaded:{pushedData:function(t){t.transitionTo("saved")},saved:{setup:function(t){var r=t._owner;var e=t._name;if(!r._internalModel._fragments[e]||t._isInitializing){return}if(!l(r,e+".hasDirtyAttributes")){b(r,e,t)}},pushedData:t.K,didCommit:t.K,becomeDirty:function(t){t.transitionTo("updated")}},created:{isDirty:true,setup:h,didCommit:function(t){t.transitionTo("saved")}},updated:{isDirty:true,setup:h,propertyWasReset:v,didCommit:function(t){t.transitionTo("saved")},rolledBack:function(t){t.transitionTo("saved")}}}};function p(t,r){for(var e in r){t[e]=r[e]}return t}function g(t,r,e){t=p(r?c(r):{},t);t.parentState=r;t.stateName=e;for(var n in t){if(!t.hasOwnProperty(n)||n==="parentState"||n==="stateName"){continue}if(typeof t[n]==="object"){t[n]=g(t[n],t,e+"."+n)}}return t}d=g(d,null,"root");var y=d;function _(t,r,e){if(!l(t,"isDeleted")){t._internalModel._attributes[r]=e;t.send("becomeDirty")}}function b(t,r){delete t._internalModel._attributes[r];if(!l(t,"isNew")){t.send("propertyWasReset",r)}}var D=t.get;var S=t.set;var A=t.computed;var w=t.ArrayProxy.extend({owner:null,name:null,init:function(){this._super();this._pendingData=undefined;S(this,"_originalState",[])},content:A(function(){return t.A()}),setupData:function(t){if(this._pendingData===t){return}this._pendingData=t;var r=this._processData(t);S(this,"_originalState",r);this.replaceContent(0,D(this,"content.length"),r);this._pendingData=undefined},_processData:function(r){return t.makeArray(r)},_createSnapshot:function(){return this.toArray()},_adapterDidCommit:function(t){if(t){this.setupData(t)}else{S(this,"_originalState",this.toArray())}},isDirty:A("hasDirtyAttributes",function(){return this.get("hasDirtyAttributes")}),hasDirtyAttributes:A("[]","_originalState",function(){return t.compare(this.toArray(),D(this,"_originalState"))!==0}),rollback:function(){this.rollbackAttributes()},rollbackAttributes:function(){this.setObjects(D(this,"_originalState"))},serialize:function(){return this.toArray()},arrayContentDidChange:function(){this._super.apply(this,arguments);var t=D(this,"owner");var r=D(this,"name");if(D(this,"hasDirtyAttributes")){_(t,r,this)}else{b(t,r)}},toStringExtension:function(){return"owner("+D(this,"owner.id")+")"}});var F=w;var z=Object.keys||Ember.keys;u.reopen({createFragment:function(t,r){var e=this.modelFor(t);Ember.assert("The '"+e+"' model must be a subclass of DS.ModelFragment",P.detect(e));var n=new a(e,null,this,this.container);n.currentState=y.empty;n._name=null;n._owner=null;n.loadedData();var i=n.getRecord();if(r){i.setProperties(r)}return i}});s.reopen({changedAttributes:function(){var t=this._super();var r=I(this);z(r._fragments).forEach(function(e){if(e in r._attributes){t[e]=true}},this);return t}});function O(t,r,e){var n=t[r];t[r]=function(){var t=n.apply(this,arguments);return e.call(this,t,arguments)}}var N=a.prototype;O(N,"createSnapshot",function _t(t){var r=t._attributes;z(r).forEach(function(t){var e=r[t];if(e&&typeof e._createSnapshot==="function"){r[t]=e._createSnapshot()}});return t});O(N,"rollbackAttributes",function bt(){for(var t in this._fragments){if(this._fragments[t]){this._fragments[t].rollbackAttributes()}}});O(N,"adapterDidCommit",function Dt(t,r){var e=r[0]&&r[0].attributes||{};var n;for(var a in this._fragments){if(n=this._fragments[a]){n._adapterDidCommit(e[a])}}});n.reopen({transformFor:function(t){if(t.indexOf("-mf-")===0){return E(this.container,this.store,t)}return this._super.apply(this,arguments)}});function E(t,r,e){var n=t._registry||t;var a="transform:"+e;var i=e.match(/^-mf-(fragment|fragment-array|array)(?:\$([^$]+))?(?:\$(.+))?$/);var s=i[1];var o=i[2];var u=i[3];if(!n.has(a)){var f=t.lookupFactory("transform:"+s);n.register(a,f.extend({store:r,modelName:o,polymorphicTypeProp:u}))}return t.lookup(a)}var T=t.get;var k=Object.create||t.create;var C=t.merge;var j=s.extend(t.Comparable,t.Copyable,{compare:function(t,r){return t===r?0:1},copy:function(){var t={};C(t,this._data);C(t,this._attributes);return this.store.createFragment(this.constructor.modelName,t)},_adapterDidCommit:function(t){I(this).setupData({attributes:t||{}})},toStringExtension:function(){return"owner("+T(I(this)._owner,"id")+")"}});function x(t,r,e){if(!r.polymorphic||!e){return t}var n=r.typeKey||"type";var a=e[n];return a||t}function I(t){var r=t._internalModel;if(!r._fragments){r._fragments=k(null)}return r}function M(t,r,e){var n=I(t);n._owner=r;n._name=e;return t}var P=j;function R(t,r,e){return t.map?t.map(r,e):V.call(t,r,e)}var K=R;function V(t){if(this===void 0||this===null||typeof t!=="function"){throw new TypeError}var r=Object(this);var e=r.length>>>0;var n=new Array(e);var a=arguments[1];for(var i=0;i<e;i++){if(i in r){n[i]=t.call(a,r[i],i,r)}}return n}var $=t.get;var L=t.computed;var W=F.extend({type:null,options:null,init:function(){this._super();this._isInitializing=false},_processData:function(r){var e=$(this,"owner");var n=$(e,"store");var a=$(this,"type");var i=$(this,"options");var s=$(this,"name");var o=$(this,"content");this._isInitializing=true;var u=K(t.makeArray(r),function(t,r){var u=o[r];if(!u){var f=x(a,i,t);u=n.createFragment(f);M(u,e,s)}I(u).setupData({attributes:t});return u});this._isInitializing=false;return u},_createSnapshot:function(){return this.map(function(t){return t._createSnapshot()})},_adapterDidCommit:function(t){this._super(t);if(!t){this.forEach(function(t){t._adapterDidCommit()})}},hasDirtyAttributes:L("@each.hasDirtyAttributes","_originalState",function(){return this._super()||this.isAny("hasDirtyAttributes")}),rollbackAttributes:function(){this._super();this.invoke("rollbackAttributes")},serialize:function(){return this.invoke("serialize")},replaceContent:function(t,r,e){var n=this;var a=$(this,"owner");var i=$(this,"name");if(e){e.forEach(function(t){var r=I(t)._owner;if(!r){M(t,a,i)}})}return $(this,"content").replace(t,r,e)},addFragment:function(t){return this.addObject(t)},removeFragment:function(t){return this.removeObject(t)},createFragment:function(t){var r=$(this,"owner");var e=$(r,"store");var n=$(this,"type");var a=e.createFragment(n,t);return this.pushObject(a)}});var J=W;var B=window.Ember;var Y=B.computed;var q;try{B.computed({set:function(){},get:function(){}});q=true}catch(G){q=false}var H=function(){var t=[];var r=arguments[arguments.length-1];if(typeof r==="function"||q){return Y.apply(this,arguments)}for(var e=0,n=arguments.length-1;e<n;e++){t.push(arguments[e])}var a;if(r.set){a=function(t,e){if(arguments.length>1){return r.set.call(this,t,e)}else{return r.get.call(this,t)}}}else{a=function(t){return r.get.call(this,t)}}t.push(a);return Y.apply(this,t)};var Q=t.get;function U(t,r,e){var n="-mf-"+t;if(r){n+="$"+r}if(e&&e.polymorphic){n+="$"+(e.typeKey||"type")}return n}function X(t,r){r=r||{};var e=U("fragment",t,r);function n(e,n,a){var i=I(n);var s=i._data[a]||it(i,r,"object");var o=i._fragments[a];var u=x(t,r,s);if(!o&&Z(e.modelFor(u),s)){o=s}else if(s&&s!==o){o||(o=M(e.createFragment(u),n,a));i._data[a]=o;I(o).setupData({attributes:s})}else{o=s}return o}function a(t,r,e,n){var a=I(t);e=n?M(n,t,r):null;if(a._data[r]!==e){_(t,r,e)}else{b(t,r)}return e}return et(e,r,n,a)}function Z(r,e){if(e instanceof r){return true}else if(t.MODEL_FACTORY_INJECTIONS){return e instanceof r.superclass}return false}function tt(r,e){e||(e={});if(t.typeOf(r)!=="string"){return rt(e)}var n=U("fragment-array",r,e);return nt(n,e,function a(t,n){return J.create({type:r,options:e,name:n,owner:t})})}function rt(t){t||(t={});var r=U("array");return nt(r,t,function e(r,n){return F.create({options:t,name:n,owner:r})})}function et(t,r,e,n){r=r||{};var a={type:t,isAttribute:true,isFragment:true,options:r};return H({get:function(t){var r=I(this);var n=e(this.store,this,t);return r._fragments[t]=n},set:function(t,r){var a=I(this);var i=e(this.store,this,t);i=n(this,t,i,r);return a._fragments[t]=i}}).meta(a)}function nt(r,e,n){function a(t,r,a){var i=I(r);var s=i._data[a]||it(i,e,"array");var o=i._fragments[a]||null;if(s instanceof F&&!o){o=s}else if(s&&s!==o){o||(o=n(r,a));i._data[a]=o;o.setupData(s)}else{o=s}return o}function i(r,e,a,i){var s=I(r);if(t.isArray(i)){a||(a=n(r,e));a.setObjects(i)}else if(i===null){a=null}else{}if(s._data[e]!==a||Q(a,"hasDirtyAttributes")){_(r,e,a)}else{b(r,e)}return a}return et(r,e,a,i)}function at(){return t.computed(function(){return I(this)._owner}).readOnly()}function it(r,e,n){var a;if(typeof e.defaultValue==="function"){a=e.defaultValue()}else if(e.defaultValue){a=e.defaultValue}else{return null}return t.copy(a,true)}var st=t.makeArray;var ot=f.extend({deserialize:function St(t){return t==null?null:st(t)},serialize:function At(t){return t&&t.toArray?t.toArray():t}});var ut=ot;var ft=t.get;var lt=f.extend({store:null,modelName:null,polymorphicTypeProp:null,deserialize:function wt(t){if(t==null){return null}return this.deserializeSingle(t)},serialize:function Ft(t){if(!t){return null}var r=this.store;var e=r.serializerFor(t.modelName);return e.serialize(t)},modelNameFor:function zt(t){var r=ft(this,"modelName");var e=ft(this,"polymorphicTypeProp");if(t&&e&&t[e]){r=t[e]}return r},deserializeSingle:function Ot(t){var r=this.store;var e=this.modelNameFor(t);var n=r.serializerFor(e);var a=ft(n,"isNewSerializerAPI");var i=r.modelFor(e);var s=n.normalize(i,t);if(a){return ft(s,"data.attributes")}else{return s}}});var ct=lt;var mt=ct.extend({deserialize:function Nt(t){if(t==null){return null}return K(t,function(t){return this.deserializeSingle(t)},this)},serialize:function Et(t){if(!t){return null}var r=this.store;return K(t,function(t){var e=r.serializerFor(t.modelName);return e.serialize(t)})}});var vt=mt;var ht=[{name:"fragmentTransform",before:"store",initialize:function(t,r){r.register("transform:fragment",ct);r.register("transform:fragment-array",vt);r.register("transform:array",ut)}}];var dt=ht;function pt(t){t.ModelFragment=P;t.FragmentArray=J;t.FragmentTransform=ct;t.FragmentArrayTransform=vt;t.ArrayTransform=ut;t.hasOneFragment=X;t.hasManyFragments=tt;t.fragmentOwner=at}var gt=t.Namespace.create({VERSION:"0.3.3+8b1fcdd5"});pt(gt);pt(r);t.onLoad("Ember.Application",function(t){dt.forEach(t.initializer,t)});if(t.libraries){t.libraries.register("Model Fragments",gt.VERSION)}var yt=gt}).call(this);