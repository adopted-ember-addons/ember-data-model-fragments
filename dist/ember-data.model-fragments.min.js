/*!
 * @overview  Ember Data Model Fragments
 * @copyright Copyright 2014 Lytics Inc. and contributors
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/lytics/ember-data.model-fragments/master/LICENSE
 * @version   0.1.0
 */
!function(a,b){b["true"]=a,function(){var a,b,c,d;!function(){var e={},f={};a=function(a,b,c){e[a]={deps:b,callback:c}},d=c=b=function(a){function c(b){if("."!==b.charAt(0))return b;for(var c=b.split("/"),d=a.split("/").slice(0,-1),e=0,f=c.length;f>e;e++){var g=c[e];if(".."===g)d.pop();else{if("."===g)continue;d.push(g)}}return d.join("/")}if(f[a])return f[a];if(f[a]={},!e[a])throw new Error("Could not find module "+a);for(var d,g=e[a],h=g.deps,i=g.callback,j=[],k=0,l=h.length;l>k;k++)j.push("exports"===h[k]?d={}:b(c(h[k])));var m=i.apply(this,j);return f[a]=d||m}}(),a("fragments/array/fragment",["./primitive","exports"],function(a,b){"use strict";var c=a["default"],d=Ember.get,e=Ember.EnumerableUtils.map,f=c.extend({type:null,setupData:function(a){var b=d(this,"owner"),c=d(b,"store"),f=d(this,"type"),g=d(this,"name"),h=d(this,"content");a=e(Ember.makeArray(a),function(a,d){var e=h[d];return e||(e=c.buildFragment(f),e.setProperties({_owner:b,_name:g})),e.setupData(a),e}),this._super(a)},isDirty:function(){return this._super()||this.isAny("isDirty")}.property("@each.isDirty"),rollback:function(){this._super(),this.invoke("rollback")},serialize:function(){return this.invoke("serialize")},replaceContent:function(a,b,c){{var e=d(this,"owner"),f=(d(e,"store"),d(this,"type"),d(this,"name"));this.originalState}return c&&c.forEach(function(a){var b=d(a,"_owner");b||a.setProperties({_owner:e,_name:f})}),d(this,"content").replace(a,b,c)},addFragment:function(a){return d(this,"content").addObject(a)},removeFragment:function(a){return d(this,"content").removeObject(a)},createFragment:function(a){var b=d(this,"owner"),c=d(b,"store"),e=d(this,"type"),f=c.createFragment(e,a);return this.pushObject(f)}});b["default"]=f}),a("fragments/array/primitive",["exports"],function(a){"use strict";var b=Ember.get,c=Array.prototype.splice,d=Ember.ArrayProxy.extend({owner:null,name:null,init:function(){this._super(),this.originalState=[]},content:function(){return Ember.A()}.property(),setupData:function(a){var d=b(this,"content");a=this.originalState=Ember.makeArray(a),c.apply(d,[0,d.length].concat(a))},isDirty:function(){return 0!==Ember.compare(this.toArray(),this.originalState)}.property("[]"),rollback:function(){this.setObjects(this.originalState)},serialize:function(){return this.toArray()},arrayContentDidChange:function(){this._super.apply(this,arguments);var a=b(this,"owner"),c=b(this,"name");this.get("isDirty")?a.fragmentDidDirty(c,this):a.fragmentDidReset(c,this)},toStringExtension:function(){return"owner("+b(this,"owner.id")+")"}});a["default"]=d}),a("fragments/attributes",["./array/primitive","./array/fragment","exports"],function(a,b,c){"use strict";function d(a,b){b=b||{};var c={type:"fragment",isAttribute:!0,isFragment:!0,options:b};return Ember.computed(function(c,d){var e=this._data[c]||g(this,b,"array"),f=this._fragments[c];return e&&e!==f&&(f||(f=this.store.buildFragment(a),f.setProperties({_owner:this,_name:c})),f.setupData(e),this._data[c]=f),arguments.length>1&&(f=d,this._data[c]!==f?this.fragmentDidDirty(c,f):this.fragmentDidReset(c,f)),this._fragments[c]=f}).property("data").meta(c)}function e(a,b){"string"!==Ember.typeOf(a)&&(b=a,a=null),b=b||{};var c={type:"fragment",isAttribute:!0,isFragment:!0,options:b,kind:"hasMany"};return Ember.computed(function(c,d){function e(){var b=a?i:h;return b.create({type:a,name:c,owner:f})}var f=this,k=this._data[c]||g(this,b,"array"),l=this._fragments[c]||null;return k&&k!==l&&(l||(l=e()),l.setupData(k),this._data[c]=l),arguments.length>1&&(Ember.isArray(d)?(l||(l=e()),l.setObjects(d)):null===d&&(l=null),this._data[c]!==l||j(l,"isDirty")?this.fragmentDidDirty(c,l):this.fragmentDidReset(c,l)),this._fragments[c]=l}).property("data").meta(c)}function f(){return Ember.computed.alias("_owner").readOnly()}function g(a,b){var c;if("function"==typeof b.defaultValue)c=b.defaultValue();else{if(!b.defaultValue)return null;c=b.defaultValue}return Ember.copy(c,!0)}var h=a["default"],i=b["default"],j=Ember.get;c.hasOneFragment=d,c.hasManyFragments=e,c.fragmentOwner=f}),a("fragments/model",["../store","../model","./states","exports"],function(a,b,c,d){"use strict";var e=a["default"],f=b["default"],g=c["default"],h=Ember.get;e.reopen({buildFragment:function(a){return a=this.modelFor(a),a.create({store:this})},createFragment:function(a,b){var c=this.buildFragment(a);return b&&c.setProperties(b),c.send("loadedData"),c}}),f.reopen({_setup:function(){this._super(),this._fragments={}},updateFragmentData:Ember.beforeObserver("data",function(a){var b;for(var c in a._fragments)b=a._fragments[c],b&&b!==a._data[c]&&(b.setupData(a._data[c]),a._data[c]=b)}),rollback:function(){this._super(),this.rollbackFragments()},rollbackFragments:function(){var a;for(var b in this._fragments)a=this._fragments[b]=this._data[b],a.rollback()},fragmentDidDirty:function(a,b){h(this,"isDeleted")||(this._attributes[a]=b,this.send("becomeDirty"))},fragmentDidReset:function(a){delete this._attributes[a],h(this,"isNew")||this.send("propertyWasReset",a)}});var i=Ember.Object.extend(Ember.Comparable,Ember.Copyable,{_name:null,_owner:null,currentState:g.empty,setupData:function(a){var b=h(this,"store"),c=h(this,"name"),d=b.modelFor(this.constructor),e=b.serializerFor(d);this._attributes={},this._data=e.normalize(d,a,c),this.send("pushedData"),this.notifyPropertyChange("data")},rollback:function(){this._attributes={},this.rollbackFragments(),this.send("rolledBack"),this.notifyPropertyChange("data")},compare:function(a,b){return a===b?0:1},copy:function(){var a=h(this,"store"),b=a.modelFor(this.constructor),c={};return Ember.merge(c,this._data),Ember.merge(c,this._attributes),this.store.createFragment(b,c)},toStringExtension:function(){return"owner("+h(this,"_owner.id")+")"},init:function(){this._super(),this._setup()}});f.proto();var j=["_setup","_unhandledEvent","send","transitionTo","data","isEmpty","isLoading","isLoaded","isDirty","isSaving","isDeleted","isNew","isValid","serialize","eachAttribute","fragmentDidDirty","fragmentDidReset","rollbackFragments"],k=j.reduce(function(a,b){return a[b]=f.prototype[b]||Ember.meta(f.prototype).descs[b],a},{});i.reopen(k,{eachRelationship:Ember.K,updateRecordArraysLater:Ember.K});var l=["attributes","eachAttribute","transformedAttributes","eachTransformedAttribute"],m=l.reduce(function(a,b){return a[b]=f[b]||Ember.meta(f).descs[b],a},{});i.reopenClass(m,{eachRelationship:Ember.K}),d["default"]=i}),a("fragments/states",["../states","exports"],function(a,b){"use strict";function c(a,b){for(var c in b)a[c]=b[c];return a}function d(a,b,e){a=c(b?Ember.create(b):{},a),a.parentState=b,a.stateName=e;for(var f in a)a.hasOwnProperty(f)&&"parentState"!==f&&"stateName"!==f&&"object"==typeof a[f]&&(a[f]=d(a[f],a,e+"."+f));return a}var e=a["default"],f=Ember.get,g=e.loaded.saved.didSetProperty,h=e.loaded.updated.uncommitted.propertyWasReset,i=function(a){var b=f(a,"_owner"),c=f(a,"_name");b&&b.fragmentDidDirty(c,a)},j={isEmpty:!1,isLoading:!1,isLoaded:!1,isDirty:!1,isSaving:!1,isDeleted:!1,isNew:!1,isValid:!0,didSetProperty:g,propertyWasReset:Ember.K,becomeDirty:Ember.K,rolledBack:Ember.K,empty:{isEmpty:!0,loadedData:function(a){a.transitionTo("loaded.created")},pushedData:function(a){a.transitionTo("loaded.saved")}},loaded:{pushedData:function(a){a.transitionTo("saved")},saved:{setup:function(a){var b=f(a,"_owner"),c=f(a,"_name");b._fragments[c]&&(f(b,c+".isDirty")||b.fragmentDidReset(c,a))},pushedData:Ember.K,becomeDirty:function(a){a.transitionTo("updated")}},created:{isDirty:!0,setup:i},updated:{isDirty:!0,setup:i,propertyWasReset:h,rolledBack:function(a){a.transitionTo("saved")}}}};j=d(j,null,"root"),b["default"]=j}),a("fragments/transform",["../transform","exports"],function(a,b){"use strict";var c=a["default"],d=c.extend({deserialize:function(a){return a},serialize:function(a){return a?a.serialize():null}});b["default"]=d}),a("initializers",["./fragments/transform","exports"],function(a,b){"use strict";var c=a["default"],d=[{name:"fragmentTransform",before:"store",initialize:function(a,b){b.register("transform:fragment",c)}}];b["default"]=d}),a("main",["./fragments/model","./fragments/array/fragment","./fragments/transform","./fragments/attributes","./initializers","exports"],function(a,b,c,d,e,f){"use strict";var g=a["default"],h=b["default"],i=c["default"],j=d.hasOneFragment,k=d.hasManyFragments,l=d.fragmentOwner,m=e["default"];DS.ModelFragment=g,DS.FragmentArray=h,DS.FragmentTransform=i,DS.hasOneFragment=j,DS.hasManyFragments=k,DS.fragmentOwner=l,Ember.onLoad("Ember.Application",function(a){m.forEach(a.initializer,a)}),Ember.libraries&&Ember.libraries.register("Model Fragments","0.1.0"),f["default"]=DS}),a("model",["exports"],function(a){"use strict";a["default"]=DS.Model}),a("states",["exports"],function(a){"use strict";a["default"]=DS.RootState}),a("store",["exports"],function(a){"use strict";a["default"]=DS.Store}),a("transform",["exports"],function(a){"use strict";a["default"]=DS.Transform}),b("main")["default"]}()}({},function(){return this}());